---
- name: Install basic packages
  apt:
    name: "{{ packages_installs }}"
    state: present
  become: true

- name: Install fd
  block:
    - name: Check if fd exists
      stat:
        path: /usr/local/bin/fd
      register: fd

    - name: Install and symlink fd-find
      block:
        - name: Install fd-find
          apt:
            name: fd-find
            state: present

        - name: Symlink fd-find (fdfind) to fd
          file:
            src: "{{ lookup('pipe', 'which fdfind') }}"
            dest: /usr/local/bin/fd
            state: link
      become: true
      when: not fd.stat.exists

- name: Install zoxide
  block:
    - name: Check if zoxide exists
      stat:
        path: /usr/local/bin/zoxide
      register: zoxide

    - name: Fresh install, unzip, move, chmod of zoxide
      block:
        - name: Create zoxide directory
          file:
            path: /tmp/zoxide
            state: directory

        - name: Download zoxide v0.7.9
          get_url:
            url: https://github.com/ajeetdsouza/zoxide/releases/download/v0.7.9/zoxide-v0.7.9-x86_64-unknown-linux-musl.tar.gz
            dest: /tmp/zoxide/zoxide.tar.gz

        - name: Unzip zoxide
          unarchive:
            src: /tmp/zoxide/zoxide.tar.gz
            dest: /tmp/zoxide

        - name: Install zoxide
          copy:
            src: /tmp/zoxide/zoxide
            dest: /usr/local/bin/zoxide
            mode: '+x'
          become: true
      when: not zoxide.stat.exists
